<html>
<head>
<script src="js/mootools-core-1.4.5-full-nocompat.js" type="text/javascript"></script>
<script src="js/youtube-downloader.js" type="text/javascript"></script>
<script src="js/mootools-more-1.4.0.1.js" type="text/javascript"></script>
<script>
// copied from http://www.massive-interactive.nl/html5_video/smpte_test_universal.html
var url = window.location.search;
function seekFrames(nr_of_frames, fps) {
	var video = document.getElementById('video');
	var div_seekInfo = document.getElementById('seekInfo');

	if (video.paused === false) {
		video.pause();
	}

	var currentFrames = Math.round(video.currentTime * fps); 
	var newPos = (currentFrames + nr_of_frames) / fps;

	//var newPos = video.currentTime += 1/fps;
	//newPos = Math.round(newPos, 2) + 1/fps; 

	var str_seekInfo = "seeking to (fixed): " + newPos + "\n";
	video.currentTime = newPos; // TELL THE PLAYER TO GO HERE
	str_seekInfo += "seek done, got: " + video.currentTime + "\n";
	var seek_error = newPos - video.currentTime;
	str_seekInfo += "seek error: " + seek_error + "\n";

  div_seekInfo.empty();
  div_seekInfo.appendText(str_seekInfo);
}

window.addEventListener('load', function() {
	var FPS = 25; // TODO - where the heck should this come from?!
    var myURI = new URI(window.location.href);
    var videoUrlBlob =  myURI.get('data');
    var parsedVideoObj = JSON.parse(videoUrlBlob.videos);
    var pickedVideoUrl = parsedVideoObj[Object.keys(parsedVideoObj)[0]];
    var video = document.getElementById('video');
    video.src = pickedVideoUrl;
	window.addEventListener('keydown', function(e) {
		var keyCode = e.keyCode;
		if(keyCode == 39) { // right arrow
			seekFrames(1, FPS);
		} else if(keyCode == 37) { // left arrow
			seekFrames(-1, FPS);
		} else if(keyCode == 32) { // spacebar
			if(video.paused) {
				video.play();
			} else {
				video.pause();
			}
		}
	}, false);

  var rightFrame = document.getElementById("rightFrame");
  rightFrame.addEvent('click', function(e) {
    seekFrames(1, FPS);
  });
  var leftFrame = document.getElementById("leftFrame");
  leftFrame.addEvent('click', function(e) {
    seekFrames(-1, FPS);
  });
}, false);
</script>
</head>
<body>

<video id="video" controls>
<source src="" type="video/mp4">
</source>
</video>

<div>
<input type="button" value="<<" id="leftFrame" />
<input type="button" value=">>" id="rightFrame" />
</div>

<div id="seekInfo"></div>

</body>
</html>
